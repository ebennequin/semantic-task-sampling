schema: '2.0'
stages:
  compute_distances@train:
    cmd: python -m src.compute_semantic_distances --split train --specs-dir data/tiered_imagenet/specs
      --output-dir data/tiered_imagenet/distances &> data/tiered_imagenet/logs/compute_distances_train.out
    deps:
    - path: data/tiered_imagenet/specs/train.json
      md5: 9d6d63b44c4496c4eb2456169e303250
      size: 24626
    - path: data/tiered_imagenet/specs/wordnet.is_a.txt
      md5: 26d5d2bf0f43a269950ae5f551dfadbd
      size: 1517000
    - path: src/compute_semantic_distances.py
      md5: d4f23ce4654ff1cf9d0b30428f918001
      size: 1492
    outs:
    - path: data/tiered_imagenet/distances/train.csv
      md5: daecfc11832898acdea1ceb04bbae72c
      size: 2252160
    - path: data/tiered_imagenet/logs/compute_distances_train.out
      md5: e1dc713e1fec5243aca80fc75ef6830e
      size: 22666
  train:
    cmd: python -m src.train --specs-dir data/tiered_imagenet/specs --distances-dir
      data/tiered_imagenet/distances --metrics-dir data/tiered_imagenet/metrics --tb-log-dir
      data/tiered_imagenet/tb_logs --output-model data/tiered_imagenet/models/trained_model.tar
      --n-epochs 100 --n-tasks-per-epoch 500 --n-way 5 --n-query 10 --n-shot 5 --sampler
      semantic --semantic-alpha 0.001 --semantic-strategy exponential --random-seed
      2 --device cuda:2 &> data/tiered_imagenet/logs/train.out
    deps:
    - path: data/tiered_imagenet/distances/train.csv
      md5: daecfc11832898acdea1ceb04bbae72c
      size: 2252160
    - path: data/tiered_imagenet/specs/train.json
      md5: 9d6d63b44c4496c4eb2456169e303250
      size: 24626
    - path: data/tiered_imagenet/specs/val.json
      md5: 41bf011f930c7b07ea8eff4216f91ee3
      size: 6846
    - path: src/train.py
      md5: d80232a8788e1a7004c92ed8ad2f55bb
      size: 5314
    outs:
    - path: data/tiered_imagenet/logs/train.out
      md5: 3dab7b42d48c87e62068289a9d0cafd4
      size: 5501436
    - path: data/tiered_imagenet/metrics/training_tasks.pkl
      md5: 9e9ccfeae9935e7771b81a7d8242a133
      size: 25621700
    - path: data/tiered_imagenet/models/trained_model.tar
      md5: b41f43d092cdf690b6f1eb6847b046c9
      size: 44785233
    - path: data/tiered_imagenet/tb_logs
      md5: b0e0bce248dcd66ea6b43681b8ef1196.dir
      size: 18632
      nfiles: 1
  get_train_stats:
    cmd: python -m src.get_training_tasks_stats --training-tasks-record data/tiered_imagenet/metrics/training_tasks.pkl
      --distances-dir data/tiered_imagenet/distances --metrics-dir data/tiered_imagenet/metrics
      &> data/tiered_imagenet/logs/get_train_stats.out
    deps:
    - path: data/tiered_imagenet/distances/train.csv
      md5: daecfc11832898acdea1ceb04bbae72c
      size: 2252160
    - path: data/tiered_imagenet/metrics/training_tasks.pkl
      md5: 9e9ccfeae9935e7771b81a7d8242a133
      size: 25621700
    - path: src/get_training_tasks_stats.py
      md5: a9d1a8424913224674a8bafe84d1d1df
      size: 1795
    outs:
    - path: data/tiered_imagenet/logs/get_train_stats.out
      md5: cbcb8cfe35217133a778f0d5f53e5f71
      size: 264
    - path: data/tiered_imagenet/metrics/intra_training_task_distances.csv
      md5: 84fed90a3d4c59727b8d56fc61013d9a
      size: 2139411
    - path: data/tiered_imagenet/metrics/training_classes_biconfusion.png
      md5: 5b489f98ae12f854e579bd5eba8e9f63
      size: 181572
    - path: data/tiered_imagenet/metrics/training_classes_sampled_together.png
      md5: df1b7f8c426f653f4a1fc68de04492cf
      size: 155144
  compute_distances@test:
    cmd: python -m src.compute_semantic_distances --split test --specs-dir data/tiered_imagenet/specs
      --output-dir data/tiered_imagenet/distances &> data/tiered_imagenet/logs/compute_distances_test.out
    deps:
    - path: data/tiered_imagenet/specs/test.json
      md5: 5eae905f4cd9e59bc0f138d5e84e485a
      size: 11256
    - path: data/tiered_imagenet/specs/wordnet.is_a.txt
      md5: 26d5d2bf0f43a269950ae5f551dfadbd
      size: 1517000
    - path: src/compute_semantic_distances.py
      md5: d4f23ce4654ff1cf9d0b30428f918001
      size: 1492
    outs:
    - path: data/tiered_imagenet/distances/test.csv
      md5: 6c704a102414fdb0e9bb200f679e3185
      size: 467360
    - path: data/tiered_imagenet/logs/compute_distances_test.out
      md5: 34ecb3b445c8735a4c8ade1bb5c2138b
      size: 8947
  create_testbed@5:
    cmd: python -m src.create_testbed --n-tasks 5000 --n-way 5 --n-query 10 --n-shot
      5 --out-file data/tiered_imagenet/testbeds/testbed_5_shot.csv &> data/tiered_imagenet/logs/create_testbed_5.out
    deps:
    - path: data/tiered_imagenet/distances/test.csv
      md5: 6c704a102414fdb0e9bb200f679e3185
      size: 467360
    - path: data/tiered_imagenet/specs/test.json
      md5: 5eae905f4cd9e59bc0f138d5e84e485a
      size: 11256
    - path: src/create_testbed.py
      md5: babf5335bec2998024222088331afcf7
      size: 8724
    outs:
    - path: data/tiered_imagenet/logs/create_testbed_5.out
      md5: 368d751902052d34d543808e0182e937
      size: 4217
    - path: data/tiered_imagenet/testbeds/testbed_5_shot.csv
      md5: 9270ad1c99238fc4b56db376235ac43d
      size: 16909711
    - path: data/tiered_imagenet/testbeds/testbed_5_shot_occ.png
      md5: edd03c3c73198093ee76c5bab45f91c7
      size: 13622
    - path: data/tiered_imagenet/testbeds/testbed_5_shot_pv.png
      md5: 82071c83b31cab5adefaf96a43768293
      size: 17355
  evaluate:
    cmd: python -m src.evaluate --specs-dir data/tiered_imagenet/specs --testbed data/tiered_imagenet/testbeds/testbed_5_shot.csv
      --trained-model data/tiered_imagenet/models/trained_model.tar --output-dir data/tiered_imagenet/metrics
      --device cuda:2 &> data/tiered_imagenet/logs/evaluate.out
    deps:
    - path: data/tiered_imagenet/models/trained_model.tar
      md5: b41f43d092cdf690b6f1eb6847b046c9
      size: 44785233
    - path: data/tiered_imagenet/specs/test.json
      md5: 5eae905f4cd9e59bc0f138d5e84e485a
      size: 11256
    - path: data/tiered_imagenet/testbeds/testbed_5_shot.csv
      md5: dcdbfef577d631c048f744c91d9cc01e
      size: 16912160
    - path: src/evaluate.py
      md5: 88072965073b573d33296c414846a537
      size: 1760
    outs:
    - path: data/tiered_imagenet/logs/evaluate.out
      md5: 965a9cda80719d84f9eefb9fcc0561e7
      size: 236835
    - path: data/tiered_imagenet/metrics/raw_results.csv
      md5: 70849f7ad615a08a211dc22293c8b023
      size: 63770849
  compute_metrics:
    cmd: python -m src.compute_metrics --testbed data/tiered_imagenet/testbeds/testbed_5_shot.csv
      --metrics-dir data/tiered_imagenet/metrics &> data/tiered_imagenet/logs/compute_metrics.out
    deps:
    - path: data/tiered_imagenet/metrics/raw_results.csv
      md5: 70849f7ad615a08a211dc22293c8b023
      size: 63770849
    - path: data/tiered_imagenet/testbeds/testbed_5_shot.csv
      md5: dcdbfef577d631c048f744c91d9cc01e
      size: 16912160
    - path: src/compute_metrics.py
      md5: c616e1d973448737fe5ed97e2bf9bec5
      size: 2422
    outs:
    - path: data/tiered_imagenet/logs/compute_metrics.out
      md5: 94aecd6e0b57cdb91fbd84b28a96a03f
      size: 681
    - path: data/tiered_imagenet/metrics/accuracy_v_variance.png
      md5: ba52a02cff053b949bb2c0eb033a3fa8
      size: 56999
    - path: data/tiered_imagenet/metrics/evaluation_metrics.json
      md5: a6782817fd7c4156997bc3e98611d8ab
      size: 226
    - path: data/tiered_imagenet/metrics/task_performances.csv
      md5: dac500f760e43167acb95d0ff4a6dc46
      size: 138300
  create_testbed@1:
    cmd: python -m src.create_testbed --n-tasks 5000 --n-way 5 --n-query 10 --n-shot
      1 --out-file data/tiered_imagenet/testbeds/testbed_1_shot.csv &> data/tiered_imagenet/logs/create_testbed_1.out
    deps:
    - path: data/tiered_imagenet/distances/test.csv
      md5: 6c704a102414fdb0e9bb200f679e3185
      size: 467360
    - path: data/tiered_imagenet/specs/test.json
      md5: 5eae905f4cd9e59bc0f138d5e84e485a
      size: 11256
    - path: src/create_testbed.py
      md5: babf5335bec2998024222088331afcf7
      size: 8724
    outs:
    - path: data/tiered_imagenet/logs/create_testbed_1.out
      md5: f279ade9a2d4ff55c669f17593b4c63e
      size: 6646
    - path: data/tiered_imagenet/testbeds/testbed_1_shot.csv
      md5: 5b27acec86929deb8bfbb296805adbba
      size: 12437499
    - path: data/tiered_imagenet/testbeds/testbed_1_shot_occ.png
      md5: edd03c3c73198093ee76c5bab45f91c7
      size: 13622
    - path: data/tiered_imagenet/testbeds/testbed_1_shot_pv.png
      md5: 82071c83b31cab5adefaf96a43768293
      size: 17355
  create_uniform_testbed@5:
    cmd: python -m src.create_uniform_testbed --n-tasks 5000 --n-way 5 --n-query 10
      --n-shot 5 --out-file data/tiered_imagenet/testbeds/testbed_uniform_5_shot.csv
      &> data/tiered_imagenet/logs/create_uniform_testbed_5.out
    deps:
    - path: data/tiered_imagenet/distances/test.csv
      md5: 6c704a102414fdb0e9bb200f679e3185
      size: 467360
    - path: data/tiered_imagenet/specs/test.json
      md5: 5eae905f4cd9e59bc0f138d5e84e485a
      size: 11256
    - path: src/create_uniform_testbed.py
      md5: 1df046bd9157d3e749988fb2001d8d8a
      size: 2960
    outs:
    - path: data/tiered_imagenet/logs/create_uniform_testbed_5.out
      md5: 668419c004f28118de41937a3e47da5b
      size: 1153
    - path: data/tiered_imagenet/testbeds/testbed_uniform_5_shot.csv
      md5: c1aafcd448c02ae515338b53cfeccd75
      size: 15351247
    - path: data/tiered_imagenet/testbeds/testbed_uniform_5_shot_occ.png
      md5: ccbc7a273f6ceaaee751198bd7a217e1
      size: 13946
    - path: data/tiered_imagenet/testbeds/testbed_uniform_5_shot_pv.png
      md5: a5d5fbbf6cbe78bf87a654ccbaaff7a1
      size: 18758
  create_uniform_testbed@1:
    cmd: python -m src.create_uniform_testbed --n-tasks 5000 --n-way 5 --n-query 10
      --n-shot 1 --out-file data/tiered_imagenet/testbeds/testbed_uniform_1_shot.csv
      &> data/tiered_imagenet/logs/create_uniform_testbed_1.out
    deps:
    - path: data/tiered_imagenet/distances/test.csv
      md5: 6c704a102414fdb0e9bb200f679e3185
      size: 467360
    - path: data/tiered_imagenet/specs/test.json
      md5: 5eae905f4cd9e59bc0f138d5e84e485a
      size: 11256
    - path: src/create_uniform_testbed.py
      md5: 1df046bd9157d3e749988fb2001d8d8a
      size: 2960
    outs:
    - path: data/tiered_imagenet/logs/create_uniform_testbed_1.out
      md5: e6e8b083e35a2588a3ffc9b8bb07071a
      size: 642
    - path: data/tiered_imagenet/testbeds/testbed_uniform_1_shot.csv
      md5: 2ff74ea213ad2eed8b567dd71339727e
      size: 11313192
    - path: data/tiered_imagenet/testbeds/testbed_uniform_1_shot_occ.png
      md5: 57d7735f228e0b929d3c1b059114990b
      size: 13522
    - path: data/tiered_imagenet/testbeds/testbed_uniform_1_shot_pv.png
      md5: 9645559b5b3cf0822cfb46cb3822441d
      size: 19065
  evaluate@5_shot:
    cmd: python -m src.evaluate --specs-dir data/tiered_imagenet/specs --testbed data/tiered_imagenet/testbeds/testbed_5_shot.csv
      --method PrototypicalNetworks --dataset tiered_imagenet --trained-model data/tiered_imagenet/models/resnet12_tiered_imagenet_classic.tar
      --output-dir data/tiered_imagenet/metrics --device cuda:0 &> data/tiered_imagenet/logs/evaluate_5_shot.out
    deps:
    - path: data/tiered_imagenet/models/resnet12_tiered_imagenet_classic.tar
      md5: b5bd56db53db9e8ec51462f92b63006a
      size: 38673827
    - path: data/tiered_imagenet/specs/test.json
      md5: 5eae905f4cd9e59bc0f138d5e84e485a
      size: 11256
    - path: data/tiered_imagenet/testbeds/testbed_5_shot.csv
      md5: 9270ad1c99238fc4b56db376235ac43d
      size: 16909711
    - path: src/evaluate.py
      md5: 525dbfa7c47caf8941e5909469370387
      size: 2140
    outs:
    - path: data/tiered_imagenet/logs/evaluate_5_shot.out
      md5: 02f84a905ac35b9d33ee9cf4a6714d12
      size: 187555
    - path: data/tiered_imagenet/metrics/raw_results_5_shot.csv
      md5: a632f722c3c37c3487b99c21982f49f2
      size: 63689719
  compute_metrics@5_shot:
    cmd: python -m src.compute_metrics --testbed-spec 5_shot &> data/tiered_imagenet/logs/compute_metrics_5_shot.out
    deps:
    - path: data/tiered_imagenet/metrics/raw_results_5_shot.csv
      md5: a632f722c3c37c3487b99c21982f49f2
      size: 63689719
    - path: data/tiered_imagenet/testbeds/testbed_5_shot.csv
      md5: 9270ad1c99238fc4b56db376235ac43d
      size: 16909711
    - path: src/compute_metrics.py
      md5: b0cd3b3ff3fdda32f6e386203fda2094
      size: 3526
    outs:
    - path: data/tiered_imagenet/logs/compute_metrics_5_shot.out
      md5: b0c0f2564aee547333508c912c530867
      size: 275
    - path: data/tiered_imagenet/metrics/evaluation_metrics_5_shot.json
      md5: 2cbc12b4f57d7052f4f98088dc869a99
      size: 215
    - path: data/tiered_imagenet/metrics/task_performances_5_shot.csv
      md5: ae6724e0177f2a2650016b325498675a
      size: 138290
  evaluate@uniform_5_shot:
    cmd: python -m src.evaluate --specs-dir data/tiered_imagenet/specs --testbed data/tiered_imagenet/testbeds/testbed_uniform_5_shot.csv
      --method PrototypicalNetworks --dataset tiered_imagenet --trained-model data/tiered_imagenet/models/resnet12_tiered_imagenet_classic.tar
      --output-dir data/tiered_imagenet/metrics --device cuda:0 &> data/tiered_imagenet/logs/evaluate_uniform_5_shot.out
    deps:
    - path: data/tiered_imagenet/models/resnet12_tiered_imagenet_classic.tar
      md5: b5bd56db53db9e8ec51462f92b63006a
      size: 38673827
    - path: data/tiered_imagenet/specs/test.json
      md5: 5eae905f4cd9e59bc0f138d5e84e485a
      size: 11256
    - path: data/tiered_imagenet/testbeds/testbed_uniform_5_shot.csv
      md5: c1aafcd448c02ae515338b53cfeccd75
      size: 15351247
    - path: src/evaluate.py
      md5: 525dbfa7c47caf8941e5909469370387
      size: 2140
    outs:
    - path: data/tiered_imagenet/logs/evaluate_uniform_5_shot.out
      md5: 0ce3935a059c9a4cdb3a7ab5b27025ac
      size: 187566
    - path: data/tiered_imagenet/metrics/raw_results_uniform_5_shot.csv
      md5: d79e84fb3530db1be96c6a75b0eaec54
      size: 64082971
  compute_metrics@uniform_5_shot:
    cmd: python -m src.compute_metrics --testbed-spec uniform_5_shot &> data/tiered_imagenet/logs/compute_metrics_uniform_5_shot.out
    deps:
    - path: data/tiered_imagenet/metrics/raw_results_uniform_5_shot.csv
      md5: d79e84fb3530db1be96c6a75b0eaec54
      size: 64082971
    - path: data/tiered_imagenet/testbeds/testbed_uniform_5_shot.csv
      md5: c1aafcd448c02ae515338b53cfeccd75
      size: 15351247
    - path: src/compute_metrics.py
      md5: b0cd3b3ff3fdda32f6e386203fda2094
      size: 3526
    outs:
    - path: data/tiered_imagenet/logs/compute_metrics_uniform_5_shot.out
      md5: e48a267e5493dbb16ef6bd1e9b140390
      size: 291
    - path: data/tiered_imagenet/metrics/evaluation_metrics_uniform_5_shot.json
      md5: 3909d73aa4a55a3e31e23b812b5e44f7
      size: 237
    - path: data/tiered_imagenet/metrics/task_performances_uniform_5_shot.csv
      md5: 625da742a43fd324c38cd4b540f34455
      size: 137160
  evaluate@uniform_1_shot:
    cmd: python -m src.evaluate --specs-dir data/tiered_imagenet/specs --testbed data/tiered_imagenet/testbeds/testbed_uniform_1_shot.csv
      --method PrototypicalNetworks --dataset tiered_imagenet --trained-model data/tiered_imagenet/models/resnet12_tiered_imagenet_classic.tar
      --output-dir data/tiered_imagenet/metrics --device cuda:0 &> data/tiered_imagenet/logs/evaluate_uniform_1_shot.out
    deps:
    - path: data/tiered_imagenet/models/resnet12_tiered_imagenet_classic.tar
      md5: b5bd56db53db9e8ec51462f92b63006a
      size: 38673827
    - path: data/tiered_imagenet/specs/test.json
      md5: 5eae905f4cd9e59bc0f138d5e84e485a
      size: 11256
    - path: data/tiered_imagenet/testbeds/testbed_uniform_1_shot.csv
      md5: 2ff74ea213ad2eed8b567dd71339727e
      size: 11313192
    - path: src/evaluate.py
      md5: 525dbfa7c47caf8941e5909469370387
      size: 2140
    outs:
    - path: data/tiered_imagenet/logs/evaluate_uniform_1_shot.out
      md5: a049d7e3ccee6b851ba5df115c3652af
      size: 187562
    - path: data/tiered_imagenet/metrics/raw_results_uniform_1_shot.csv
      md5: c24110ff1a60c3dcb8185cf5048a3e65
      size: 63787890
  compute_metrics@uniform_1_shot:
    cmd: python -m src.compute_metrics --testbed-spec uniform_1_shot &> data/tiered_imagenet/logs/compute_metrics_uniform_1_shot.out
    deps:
    - path: data/tiered_imagenet/metrics/raw_results_uniform_1_shot.csv
      md5: c24110ff1a60c3dcb8185cf5048a3e65
      size: 63787890
    - path: data/tiered_imagenet/testbeds/testbed_uniform_1_shot.csv
      md5: 2ff74ea213ad2eed8b567dd71339727e
      size: 11313192
    - path: src/compute_metrics.py
      md5: b0cd3b3ff3fdda32f6e386203fda2094
      size: 3526
    outs:
    - path: data/tiered_imagenet/logs/compute_metrics_uniform_1_shot.out
      md5: ff4fa13fb287a63bc55e909056b5dd0d
      size: 291
    - path: data/tiered_imagenet/metrics/evaluation_metrics_uniform_1_shot.json
      md5: 4528a1773fe609af9e9d975a0e863f42
      size: 205
    - path: data/tiered_imagenet/metrics/task_performances_uniform_1_shot.csv
      md5: a93c5c31b7cfe6091e3e53fdd330af13
      size: 137051
  evaluate@1_shot:
    cmd: python -m src.evaluate --specs-dir data/tiered_imagenet/specs --testbed data/tiered_imagenet/testbeds/testbed_1_shot.csv
      --method PrototypicalNetworks --dataset tiered_imagenet --trained-model data/tiered_imagenet/models/resnet12_tiered_imagenet_classic.tar
      --output-dir data/tiered_imagenet/metrics --device cuda:0 &> data/tiered_imagenet/logs/evaluate_1_shot.out
    deps:
    - path: data/tiered_imagenet/models/resnet12_tiered_imagenet_classic.tar
      md5: b5bd56db53db9e8ec51462f92b63006a
      size: 38673827
    - path: data/tiered_imagenet/specs/test.json
      md5: 5eae905f4cd9e59bc0f138d5e84e485a
      size: 11256
    - path: data/tiered_imagenet/testbeds/testbed_1_shot.csv
      md5: 5b27acec86929deb8bfbb296805adbba
      size: 12437499
    - path: src/evaluate.py
      md5: 525dbfa7c47caf8941e5909469370387
      size: 2140
    outs:
    - path: data/tiered_imagenet/logs/evaluate_1_shot.out
      md5: bff596a876d134fd3eecba4c5d0829f5
      size: 187558
    - path: data/tiered_imagenet/metrics/raw_results_1_shot.csv
      md5: d9bafe88b6e654a51c79703957c0103a
      size: 63667478
  compute_metrics@1_shot:
    cmd: python -m src.compute_metrics --testbed-spec 1_shot &> data/tiered_imagenet/logs/compute_metrics_1_shot.out
    deps:
    - path: data/tiered_imagenet/metrics/raw_results_1_shot.csv
      md5: d9bafe88b6e654a51c79703957c0103a
      size: 63667478
    - path: data/tiered_imagenet/testbeds/testbed_1_shot.csv
      md5: 5b27acec86929deb8bfbb296805adbba
      size: 12437499
    - path: src/compute_metrics.py
      md5: b0cd3b3ff3fdda32f6e386203fda2094
      size: 3526
    outs:
    - path: data/tiered_imagenet/logs/compute_metrics_1_shot.out
      md5: c131e17bb8ae95687deb0b59bf7b33b2
      size: 275
    - path: data/tiered_imagenet/metrics/evaluation_metrics_1_shot.json
      md5: 531e952616205abac5aa8414f01bb0c7
      size: 216
    - path: data/tiered_imagenet/metrics/task_performances_1_shot.csv
      md5: e5869375b97308009b005efa9174fb12
      size: 138330

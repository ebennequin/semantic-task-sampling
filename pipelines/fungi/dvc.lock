schema: '2.0'
stages:
  compute_distances:
    cmd: python -m src.compute_semantic_distances --specs-dir data/fungi/specs --output-dir
      data/fungi --dataset fungi &> data/fungi/logs/compute_distances.out
    deps:
    - path: data/fungi/specs/DF20_metadata.csv
      md5: 27418931dad9162dcedb69cc91ea5799
      size: 86434321
    - path: data/fungi/specs/fungi_dag.json
      md5: 2b35cd031f41ec4e8bf7db5abbaa9807
      size: 195213
    - path: src/compute_semantic_distances.py
      md5: d4f23ce4654ff1cf9d0b30428f918001
      size: 1492
    params:
      pipelines/fungi/params.yaml:
        distances_dir: data/fungi
        logs_dir: data/fungi/logs
        specs_dir: data/fungi/specs
    outs:
    - path: data/fungi/distances.csv
      md5: 78b49d4b3e7e720c3daad11b2e9831cc
      size: 48132974
    - path: data/fungi/logs/compute_distances.out
      md5: d0653eca86ba251b54a5e500bd46e664
      size: 110051
  create_uniform_testbed@5:
    cmd: python -m src.create_uniform_testbed --n-tasks 1000 --n-way 100 --n-query
      5 --n-shot 5 --distances-csv data/fungi/distances.csv --out-file data/fungi/testbeds/testbed_uniform_5_shot.csv
      --dataset fungi &> data/fungi/logs/create_uniform_testbed_5.out
    deps:
    - path: data/fungi/distances.csv
      md5: 78b49d4b3e7e720c3daad11b2e9831cc
      size: 48132974
    - path: data/fungi/specs/DF20_metadata.csv
      md5: 27418931dad9162dcedb69cc91ea5799
      size: 86434321
    - path: data/fungi/specs/fungi_dag.json
      md5: 2b35cd031f41ec4e8bf7db5abbaa9807
      size: 195213
    - path: src/create_uniform_testbed.py
      md5: 1df046bd9157d3e749988fb2001d8d8a
      size: 2960
    params:
      pipelines/fungi/params.yaml:
        distances_dir: data/fungi
        logs_dir: data/fungi/logs
        specs_dir: data/fungi/specs
        testbed:
          n_tasks: 1000
          n_way: 100
          n_query: 5
          n_shot:
          - 1
          - 5
        testbeds_dir: data/fungi/testbeds
    outs:
    - path: data/fungi/logs/create_uniform_testbed_5.out
      md5: ea57a83e344be38a626eb68d7f8caf57
      size: 612
    - path: data/fungi/testbeds/testbed_uniform_5_shot.csv
      md5: d41acd2c55483ae227248a5b6383a0a8
      size: 42896280
    - path: data/fungi/testbeds/testbed_uniform_5_shot_occ.png
      md5: 36b6f86c6d35bda7e68cc2bbae7bd123
      size: 14691
    - path: data/fungi/testbeds/testbed_uniform_5_shot_pv.png
      md5: 28bf15275367a075ef3c23e8d1123cb6
      size: 14058
  create_uniform_testbed@1:
    cmd: python -m src.create_uniform_testbed --n-tasks 1000 --n-way 100 --n-query
      5 --n-shot 1 --distances-csv data/fungi/distances.csv --out-file data/fungi/testbeds/testbed_uniform_1_shot.csv
      --dataset fungi &> data/fungi/logs/create_uniform_testbed_1.out
    deps:
    - path: data/fungi/distances.csv
      md5: 78b49d4b3e7e720c3daad11b2e9831cc
      size: 48132974
    - path: data/fungi/specs/DF20_metadata.csv
      md5: 27418931dad9162dcedb69cc91ea5799
      size: 86434321
    - path: data/fungi/specs/fungi_dag.json
      md5: 2b35cd031f41ec4e8bf7db5abbaa9807
      size: 195213
    - path: src/create_uniform_testbed.py
      md5: 1df046bd9157d3e749988fb2001d8d8a
      size: 2960
    params:
      pipelines/fungi/params.yaml:
        distances_dir: data/fungi
        logs_dir: data/fungi/logs
        specs_dir: data/fungi/specs
        testbed:
          n_tasks: 1000
          n_way: 100
          n_query: 5
          n_shot:
          - 1
          - 5
        testbeds_dir: data/fungi/testbeds
    outs:
    - path: data/fungi/logs/create_uniform_testbed_1.out
      md5: 6069d564de2f757647d038e9541921d3
      size: 612
    - path: data/fungi/testbeds/testbed_uniform_1_shot.csv
      md5: 2d4a98fd588111f753c63d6e725c5a13
      size: 25892620
    - path: data/fungi/testbeds/testbed_uniform_1_shot_occ.png
      md5: 2266e41067e4fe4b49780b2507557521
      size: 13454
    - path: data/fungi/testbeds/testbed_uniform_1_shot_pv.png
      md5: d1ba5e7ecad44f149164f5978381eef8
      size: 15182
  evaluate@uniform_5_shot:
    cmd: python -m src.evaluate --specs-dir data/fungi/specs --testbed data/fungi/testbeds/testbed_uniform_5_shot.csv
      --method PrototypicalNetworks --dataset fungi --output-dir data/fungi/metrics
      --device cuda:0 &> data/fungi/logs/evaluate_uniform_5_shot.out
    deps:
    - path: data/fungi/specs/DF20_metadata.csv
      md5: 27418931dad9162dcedb69cc91ea5799
      size: 86434321
    - path: data/fungi/testbeds/testbed_uniform_5_shot.csv
      md5: d41acd2c55483ae227248a5b6383a0a8
      size: 42896280
    - path: src/evaluate.py
      md5: 525dbfa7c47caf8941e5909469370387
      size: 2140
    params:
      pipelines/fungi/params.yaml:
        device: cuda:0
        logs_dir: data/fungi/logs
        metrics_dir: data/fungi/metrics
        model:
          method: PrototypicalNetworks
        specs_dir: data/fungi/specs
        testbeds_dir: data/fungi/testbeds
        testbeds_grid:
        - uniform_1_shot
        - uniform_5_shot
    outs:
    - path: data/fungi/logs/evaluate_uniform_5_shot.out
      md5: a857076699346caf6a899208b08fea11
      size: 74820
    - path: data/fungi/metrics/raw_results_uniform_5_shot.csv
      md5: 19e6c547921e8d762627e7227f68ee04
      size: 2684107670
  compute_metrics@uniform_5_shot:
    cmd: python -m src.compute_metrics --testbed-spec uniform_5_shot --top-k 1,5 --testbeds-dir
      data/fungi/testbeds --metrics-dir data/fungi/metrics &> data/fungi/logs/compute_metrics_uniform_5_shot.out
    deps:
    - path: data/fungi/metrics/raw_results_uniform_5_shot.csv
      md5: 19e6c547921e8d762627e7227f68ee04
      size: 2684107670
    - path: data/fungi/testbeds/testbed_uniform_5_shot.csv
      md5: d41acd2c55483ae227248a5b6383a0a8
      size: 42896280
    - path: src/compute_metrics.py
      md5: b0cd3b3ff3fdda32f6e386203fda2094
      size: 3526
    params:
      pipelines/fungi/params.yaml:
        logs_dir: data/fungi/logs
        metrics_dir: data/fungi/metrics
        testbeds_dir: data/fungi/testbeds
        testbeds_grid:
        - uniform_1_shot
        - uniform_5_shot
    outs:
    - path: data/fungi/logs/compute_metrics_uniform_5_shot.out
      md5: f6164c598f4d768ffc2c892ade8922d4
      size: 271
    - path: data/fungi/metrics/evaluation_metrics_uniform_5_shot.json
      md5: 1571b249aa353fcb89a630d03e3294af
      size: 427
    - path: data/fungi/metrics/task_performances_uniform_5_shot.csv
      md5: 176000b044efa382d190bcefb133f336
      size: 33961
  evaluate@uniform_1_shot:
    cmd: python -m src.evaluate --specs-dir data/fungi/specs --testbed data/fungi/testbeds/testbed_uniform_1_shot.csv
      --method PrototypicalNetworks --dataset fungi --output-dir data/fungi/metrics
      --device cuda:0 &> data/fungi/logs/evaluate_uniform_1_shot.out
    deps:
    - path: data/fungi/specs/DF20_metadata.csv
      md5: 27418931dad9162dcedb69cc91ea5799
      size: 86434321
    - path: data/fungi/testbeds/testbed_uniform_1_shot.csv
      md5: 2d4a98fd588111f753c63d6e725c5a13
      size: 25892620
    - path: src/evaluate.py
      md5: 525dbfa7c47caf8941e5909469370387
      size: 2140
    params:
      pipelines/fungi/params.yaml:
        device: cuda:0
        logs_dir: data/fungi/logs
        metrics_dir: data/fungi/metrics
        model:
          method: PrototypicalNetworks
        specs_dir: data/fungi/specs
        testbeds_dir: data/fungi/testbeds
        testbeds_grid:
        - uniform_1_shot
        - uniform_5_shot
    outs:
    - path: data/fungi/logs/evaluate_uniform_1_shot.out
      md5: a2abc58a5335e6bb617b5c2d303552b4
      size: 74820
    - path: data/fungi/metrics/raw_results_uniform_1_shot.csv
      md5: 6473ad193f3f0b826185e9992bc2a1dd
      size: 2717728971
  compute_metrics@uniform_1_shot:
    cmd: python -m src.compute_metrics --testbed-spec uniform_1_shot --top-k 1,5 --testbeds-dir
      data/fungi/testbeds --metrics-dir data/fungi/metrics &> data/fungi/logs/compute_metrics_uniform_1_shot.out
    deps:
    - path: data/fungi/metrics/raw_results_uniform_1_shot.csv
      md5: 6473ad193f3f0b826185e9992bc2a1dd
      size: 2717728971
    - path: data/fungi/testbeds/testbed_uniform_1_shot.csv
      md5: 2d4a98fd588111f753c63d6e725c5a13
      size: 25892620
    - path: src/compute_metrics.py
      md5: b0cd3b3ff3fdda32f6e386203fda2094
      size: 3526
    params:
      pipelines/fungi/params.yaml:
        logs_dir: data/fungi/logs
        metrics_dir: data/fungi/metrics
        testbeds_dir: data/fungi/testbeds
        testbeds_grid:
        - uniform_1_shot
        - uniform_5_shot
    outs:
    - path: data/fungi/logs/compute_metrics_uniform_1_shot.out
      md5: d431c27b1dd11e00f2f327a7819b4f10
      size: 271
    - path: data/fungi/metrics/evaluation_metrics_uniform_1_shot.json
      md5: 2861aa7a5b147b462e03bbcac48ee12b
      size: 459
    - path: data/fungi/metrics/task_performances_uniform_1_shot.csv
      md5: 094e33b66ae61b75c3ec0adfafb72722
      size: 34071
